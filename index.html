<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 1, Lecture 1: Play with Numbers and Text</title>

    <!-- Prism for syntax highlighting with accessible theme -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>

    <!-- Marked for Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- KaTeX for math -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>

    <style>
        :root {
            /* High contrast color scheme */
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f5;
            --bg-code: #1e1e1e;
            --text-primary: #000000;
            --text-secondary: #333333;
            --text-code: #f8f8f2;
            --accent-primary: #0066cc;
            --accent-hover: #0052a3;
            --border-color: #666666;
            --output-bg: #fafafa;
            --success-color: #008000;
            --error-color: #cc0000;

            /* Font sizes for accessibility */
            --font-size-base: 18px;
            --font-size-small: 16px;
            --font-size-code: 16px;
            --font-size-h1: 32px;
            --font-size-h2: 28px;
            --font-size-h3: 24px;
            --line-height: 1.6;
            --code-line-height: 1.8;
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-primary: #1a1a1a;
                --bg-secondary: #2a2a2a;
                --bg-code: #000000;
                --text-primary: #ffffff;
                --text-secondary: #e0e0e0;
                --text-code: #f8f8f2;
                --accent-primary: #4da6ff;
                --accent-hover: #66b3ff;
                --border-color: #999999;
                --output-bg: #2a2a2a;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            font-size: var(--font-size-base);
            line-height: var(--line-height);
            color: var(--text-primary);
            background-color: var(--bg-primary);
            padding: 20px;
        }

        /* Skip to main content link for screen readers */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--accent-primary);
            color: white;
            padding: 8px;
            text-decoration: none;
            z-index: 100;
        }

        .skip-link:focus {
            top: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-hover));
            color: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: var(--font-size-h1);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            font-size: var(--font-size-base);
        }

        .toolbar {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 2px solid var(--border-color);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn {
            background: var(--accent-primary);
            color: white;
            border: 2px solid transparent;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: var(--font-size-base);
            font-weight: 500;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            min-height: 44px; /* WCAG minimum touch target */
        }

        .btn:hover, .btn:focus {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            outline: 3px solid var(--accent-primary);
            outline-offset: 2px;
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.secondary {
            background: #666666;
        }

        .btn.secondary:hover, .btn.secondary:focus {
            background: #555555;
        }

        /* Cells */
        .cell {
            background: var(--bg-primary);
            margin-bottom: 20px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
        }

        .cell:focus-within {
            outline: 3px solid var(--accent-primary);
            outline-offset: 2px;
        }

        .cell-header {
            padding: 15px 20px;
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cell-number {
            color: var(--text-secondary);
            font-size: var(--font-size-base);
            font-weight: 600;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        }

        .cell-content {
            padding: 20px;
        }

        /* Markdown cells */
        .markdown-content {
            color: var(--text-primary);
            font-size: var(--font-size-base);
            line-height: var(--line-height);
        }

        .markdown-content h1 {
            font-size: var(--font-size-h1);
            font-weight: 600;
            margin: 30px 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--border-color);
        }

        .markdown-content h2 {
            font-size: var(--font-size-h2);
            font-weight: 600;
            margin: 25px 0 15px 0;
        }

        .markdown-content h3 {
            font-size: var(--font-size-h3);
            font-weight: 600;
            margin: 20px 0 10px 0;
        }

        .markdown-content p {
            margin-bottom: 15px;
            line-height: var(--line-height);
        }

        .markdown-content ul, .markdown-content ol {
            margin: 15px 0 15px 30px;
            line-height: var(--line-height);
        }

        .markdown-content li {
            margin-bottom: 8px;
            line-height: var(--line-height);
        }

        .markdown-content strong {
            font-weight: 700;
            color: var(--text-primary);
        }

        .markdown-content em {
            font-style: italic;
        }

        .markdown-content code {
            background: var(--bg-secondary);
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: var(--font-size-code);
            border: 1px solid var(--border-color);
        }

        .markdown-content pre {
            background: var(--bg-code);
            color: var(--text-code);
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-size: var(--font-size-code);
            line-height: var(--code-line-height);
            border: 2px solid var(--border-color);
        }

        .markdown-content pre code {
            background: none;
            border: none;
            padding: 0;
            color: inherit;
        }

        .markdown-content a {
            color: var(--accent-primary);
            text-decoration: underline;
            font-weight: 500;
        }

        .markdown-content a:hover, .markdown-content a:focus {
            color: var(--accent-hover);
            outline: 2px solid var(--accent-primary);
            outline-offset: 2px;
        }

        .markdown-content table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            font-size: var(--font-size-base);
        }

        .markdown-content th, .markdown-content td {
            border: 2px solid var(--border-color);
            padding: 12px 15px;
            text-align: left;
        }

        .markdown-content th {
            background: var(--bg-secondary);
            font-weight: 700;
        }

        .markdown-content img {
            max-width: 100%;
            height: auto;
        }

        /* Code cells */
        .code-input {
            background: var(--bg-code);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 10px;
            position: relative;
            border: 2px solid var(--border-color);
        }

        .code-input pre {
            margin: 0;
            color: var(--text-code);
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: var(--font-size-code);
            line-height: var(--code-line-height);
            overflow-x: auto;
        }

        .code-input code {
            font-size: var(--font-size-code) !important;
            line-height: var(--code-line-height) !important;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace !important;
        }

        /* Custom syntax highlighting for better readability */
        .token.comment {
            color: #6a9955;
            font-style: italic;
        }

        .token.string {
            color: #ce9178;
        }

        .token.keyword {
            color: #569cd6;
            font-weight: 600;
        }

        .token.function {
            color: #dcdcaa;
        }

        .token.number {
            color: #b5cea8;
        }

        .token.operator {
            color: #d4d4d4;
        }

        .run-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--accent-primary);
            color: white;
            border: 2px solid white;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: var(--font-size-small);
            font-weight: 600;
            cursor: pointer;
            min-height: 44px;
        }

        .run-button:hover, .run-button:focus {
            background: var(--accent-hover);
            outline: 3px solid white;
            outline-offset: 2px;
        }

        .loading {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-secondary);
            font-size: var(--font-size-base);
            padding: 10px 0;
        }

        .loading-spinner {
            width: 24px;
            height: 24px;
            border: 3px solid var(--border-color);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .output-area {
            background: var(--output-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: var(--font-size-code);
            line-height: var(--code-line-height);
            color: var(--text-primary);
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 500px;
            overflow-y: auto;
        }

        .output-area.hidden {
            display: none;
        }

        .output-label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-secondary);
            font-size: var(--font-size-small);
        }

        .output-area .html-output {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        .output-area .html-output table {
            border-collapse: collapse;
            font-size: var(--font-size-base);
            width: 100%;
            margin: 10px 0;
        }

        .output-area .html-output th,
        .output-area .html-output td {
            padding: 10px 15px;
            border: 2px solid var(--border-color);
            text-align: left;
        }

        .output-area .html-output th {
            background: var(--bg-secondary);
            font-weight: 700;
            color: var(--text-primary);
        }

        .output-area .error-output {
            color: var(--error-color);
            white-space: pre-wrap;
        }

        .output-area img {
            max-width: 100%;
            height: auto;
        }

        /* Loading animation */
        .loading {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
        }

        .loading-spinner {
            width: 24px;
            height: 24px;
            border: 3px solid var(--accent-primary);
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .execution-count {
            color: var(--text-secondary);
            font-size: var(--font-size-small);
            margin-top: 10px;
            font-style: italic;
        }

        /* Accessibility improvements */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* Focus indicators */
        *:focus {
            outline: 3px solid var(--accent-primary);
            outline-offset: 2px;
        }

        /* Print styles */
        @media print {
            body {
                font-size: 12pt;
                line-height: 1.5;
            }

            .toolbar, .run-button {
                display: none;
            }

            .cell {
                page-break-inside: avoid;
            }
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --border-color: #000000;
                --accent-primary: #0000ff;
                --bg-code: #000000;
                --text-code: #ffffff;
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Mobile responsive design */
        @media (max-width: 768px) {
            body {
                font-size: 16px;
                padding: 10px;
            }

            .header {
                padding: 20px;
            }

            .toolbar {
                flex-direction: column;
                align-items: stretch;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .code-input pre {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <div class="container">
        <header class="header" role="banner">
            <h1>Module 1, Lecture 1: Play with Numbers and Text</h1>
            <p>Interactive accessible notebook viewer &mdash; generated by jupyderp</p>
        </header>

        <nav class="toolbar" role="navigation" aria-label="Notebook controls">
            <button class="btn" onclick="runAllCells()" aria-label="Run all code cells">
                <span aria-hidden="true">&#9654;</span> Run All Cells
            </button>
            <button class="btn secondary" onclick="clearOutputs()" aria-label="Clear all cell outputs">
                <span aria-hidden="true">&#9003;</span> Clear All Outputs
            </button>
            <button class="btn secondary" onclick="resetNotebook()" aria-label="Reset notebook to initial state">
                <span aria-hidden="true">&#8635;</span> Reset Notebook
            </button>
        </nav>

        <main id="main-content" role="main">
            <div id="notebook" aria-label="Notebook cells"></div>
        </main>
    </div>

    <script>
        // ---------- Notebook cell data (injected by jupyderp) ----------
        const notebookCells = [{"type": "markdown", "content": "# Module 1, Lecture 1: Play with Numbers and Text\nIn this notebook, you'll:\n- Play with expressions\n- Create variables with assigments\n- Run already existing functions\n- Write your own functions\n\nThis notebook is divided into sections. You'll modify and run only code cells."}, {"type": "markdown", "content": "## Kinds of Code Lines You'll Write (Expressions)\n\nEach line below is an expression. It evaluates to one value. Each line in the cell below is intially commented out; it has a `#` at the beginning. Any line with a `#` does not run. \n\n* Uncomment each line one at a time by deleting the `#` and space\n* Run the cell by clicking the triangle to the left of the cell\n* See what the result of the expression is (and can you guess the type of the result?)"}, {"type": "code", "content": "\"hello\"\n#3.14 * 9.8**2\n#(25 + 37) * 2\n#'Maria' + 'Smith'\n#'ma'*3\n", "output": "'hello'", "outputHtml": null, "images": null, "error": null, "executionCount": 1}, {"type": "markdown", "content": "## Kinds of Code Lines You'll Write (Assignments)\n\nVariables are names for values. To determine the value for a variable name, first determine what the righ side of the equal evaluates to. Then, the name now points to that value. \n\nThere are 4 variables created in the cell below: `fname`, `lname`, `area`, and `name`. What are the values associated with these names after all lines of code run?"}, {"type": "code", "content": "fname = 'Maria'\nlname = 'Smith'\narea = 3.14 * 9.8**2\n\nname = fname + lname\n#print(name)\n", "executionCount": 9}, {"type": "markdown", "content": "## Kinds of Code Lines You'll Write (Function Calls)\n\nA function is a bunch of code that runs behind the scenes, except that all that code has been bundled up to be easily accessible by a name. There are 5 examples of function names below: `print`, `max`, `len`, `int`, and `float`. \n\nWhen you ask a function to do some work for you, the procedure is to write the name of the function and then type parentheses right after it. The parentheses hold what inputs are needed for the function to begin doing its work. Behind the scenes, the function runs whatever lines of code define it, and then gives us back one (and only one) value. That value entirely replaces the function call we just did.  \n\nUncomment each line of code below and run the cell to see what each function gives back. "}, {"type": "code", "content": "print('hello')\n# max(4,8,1,5)\n# len('Maria Smith')\n# int(5.7)\n# float(8)\n", "output": "hello\n", "outputHtml": null, "images": null, "error": null}, {"type": "markdown", "content": "## Wrong ways to print\n\nLet's dive deeper into the `print` function. Printing is the primary way of writing programs that show something to the user. Fix each of the lines below to successfully print without an error. Uncomment each line one at a time, see what error it gives, and fix it."}, {"type": "code", "content": "# print('hi'\n# print \"hola\"\n# print(ciao)\n# print(67+'41')\n# print(len(\"Maria Smith'))\n# print(ints(5.7))\n"}, {"type": "markdown", "content": "## Your First Program to Print\n\nNotice that the code that does the task for the function is indented. Indentation is how we denote code blocks. In this case, anything indented is part of the function body.\n\nRun the cell below. Each function call asks the function to run its body. There are 3 printouts, one for each function call. "}, {"type": "code", "content": "def double(x):\n  \"\"\" x is a number\n  Prints the double of x \"\"\"\n  print(x*2)\n\ndouble(5)\ndouble(17)\ndouble(-3)\n", "output": "10\n34\n-6\n", "outputHtml": null, "images": null, "error": null}, {"type": "markdown", "content": "## A Program That Saves Values\n\nRecall that making a function call replaces that call with whatever the function returns. These lines do not do anything with that return, so we don't see any value if they are just on a line. \n\n```\ndouble(5)\ndouble(17)\ndouble(-3)\n```\n\nInstead, save the results of the function call to a variable. Then you can print it, or use it future calculations.\n\n"}, {"type": "code", "content": "def double(x):\n  \"\"\" x is a number\n  Returns the double of x \"\"\"\n  return x*2\n\ndouble(5)\ndouble(17)\ndouble(-3)\n\nn1 = double(5)\nn2 = double(17)\nn3 = double(-3)\nn4 = double(n1)\n\nprint(n1, n2, n3, n4)\n", "output": "10 34 -6 20\n", "outputHtml": null, "images": null, "error": null, "executionCount": 2}, {"type": "markdown", "content": "## Test and Debug This Code"}, {"type": "code", "content": "def calculate_total(cost, tax):\n    \"\"\" cost is a number >= 0\n        tax is a number representing a percent\n    Returns the total cost, including the tax. \"\"\"\n    tax = tax*cost\n    new_cost = cost+tax\n    return cost\n\nn = calculate_total(10, 20)\nprint(n)     # should be 12.0\n", "output": "10\n", "outputHtml": null, "images": null, "error": null, "executionCount": 3}, {"type": "markdown", "content": "## Fixed Code"}, {"type": "code", "content": "def calculate_total(cost, tax):\n    \"\"\" cost is a number >= 0\n        tax is a number representing a percent\n    Returns the total cost, including the tax. \"\"\"\n    tax = tax*cost/100\n    new_cost = cost+tax\n    return new_cost\n\nn = calculate_total(10, 20)\nprint(n)     # should be 12.0\n"}, {"type": "markdown", "content": "## Getting Input\n\nThe function `input` reads whatever the user types in and saves it as a string. Even if the user enters numbers, the numbers are actually string characters representing that number. "}, {"type": "code", "content": "text = input(\"Type anything: \")\nprint(5*text)\n"}, {"type": "markdown", "content": "## Working With Types and Input\n\nCasting is the process of making a new version of an object that is of a different type. IN the cell below, two steps are being done in one in the line\n\n```\n int(input(\"Your age: \"))\n ```\n \n The first is to get the input from the user, and save it as a string. \n \n ```\n input(\"Your age: \")\n ```\n \n Then, that string value is converted to the integer version of whatever was typed in. \n \n * If the user typed in `9`: `int(\"9\")`  <-- Python knows how to do this\n * If the user typed in `hi`: `int(\"hi\")`  <-- Python gives an error with this"}, {"type": "code", "content": "num1 = input(\"Your age: \")\nprint(5*num1)\n\nnum2 = int(input(\"Your age: \"))\nprint(5*num2)\n"}];
        const PRISM_LANG = "python";

        let isExecuting = false;
        let currentCell = 0;

        // ---------- Helpers ----------
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function renderMarkdown(content) {
            let html = marked.parse(content);
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = html;
            if (typeof renderMathInElement !== 'undefined') {
                renderMathInElement(tempDiv, {
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '$', right: '$', display: false},
                        {left: '\\(', right: '\\)', display: false},
                        {left: '\\[', right: '\\]', display: true}
                    ]
                });
            }
            return tempDiv.innerHTML;
        }

        // ---------- Build output HTML from cell data ----------
        function buildOutputHtml(cell) {
            let parts = [];
            if (cell.output) {
                parts.push(escapeHtml(cell.output));
            }
            if (cell.outputHtml) {
                parts.push('<div class="html-output">' + cell.outputHtml + '</div>');
            }
            if (cell.images && cell.images.length) {
                for (const img of cell.images) {
                    parts.push('<img src="data:image/png;base64,' + img + '" alt="Cell output image">');
                }
            }
            if (cell.error) {
                parts.push('<div class="error-output">' + escapeHtml(cell.error) + '</div>');
            }
            return parts.join('\n');
        }

        function hasOutput(cell) {
            return !!(cell.output || cell.outputHtml || (cell.images && cell.images.length) || cell.error);
        }

        // ---------- Render one cell ----------
        function renderCell(cell, index) {
            const cellDiv = document.createElement('div');
            cellDiv.className = 'cell ' + (cell.type === 'code' ? 'code-cell' : 'markdown-cell');
            cellDiv.id = 'cell-' + index;
            cellDiv.setAttribute('role', 'article');
            cellDiv.setAttribute('aria-label', cell.type + ' cell ' + index);

            if (cell.type === 'markdown') {
                cellDiv.innerHTML =
                    '<div class="cell-content">' +
                        '<div class="markdown-content">' +
                            renderMarkdown(cell.content) +
                        '</div>' +
                    '</div>';
            } else {
                const execLabel = cell.executionCount != null
                    ? 'In [' + cell.executionCount + ']:'
                    : 'In [&nbsp;]:';

                cellDiv.innerHTML =
                    '<div class="cell-header">' +
                        '<span class="cell-number" aria-label="Cell number">' + execLabel + '</span>' +
                    '</div>' +
                    '<div class="cell-content">' +
                        '<div class="code-input" role="region" aria-label="Code input">' +
                            '<button class="run-button" onclick="executeCell(' + index + ')" ' +
                                    'aria-label="Run cell ' + index + '">' +
                                'Run Cell' +
                            '</button>' +
                            '<pre><code class="language-' + PRISM_LANG + '">' + escapeHtml(cell.content) + '</code></pre>' +
                        '</div>' +
                        '<div class="output-area hidden" ' +
                             'id="output-' + index + '" ' +
                             'role="region" ' +
                             'aria-label="Cell output" ' +
                             'aria-live="polite">' +
                        '</div>' +
                    '</div>';
            }

            return cellDiv;
        }

        // ---------- Execute a single cell ----------
        function executeCell(index) {
            if (isExecuting) return;

            var cell = notebookCells[index];
            if (cell.type !== 'code') return;

            isExecuting = true;
            var outputDiv = document.getElementById('output-' + index);
            var cellDiv = document.getElementById('cell-' + index);

            // Show loading spinner
            outputDiv.classList.remove('hidden');
            outputDiv.innerHTML =
                '<div class="loading">' +
                    '<div class="loading-spinner"></div>' +
                    '<span>Executing cell...</span>' +
                '</div>';

            // Simulate execution delay, then show output
            setTimeout(function() {
                if (hasOutput(cell)) {
                    outputDiv.innerHTML =
                        '<span class="output-label">Output:</span>' +
                        buildOutputHtml(cell);
                } else {
                    outputDiv.innerHTML =
                        '<span style="color: var(--text-secondary);">' +
                        'Cell executed successfully (no output)</span>';
                }

                isExecuting = false;

                // If running all, advance to the next code cell
                if (window.runningAll) {
                    advanceRunAll();
                }
            }, Math.random() * 800 + 400);
        }

        // ---------- Run All Cells ----------
        function runAllCells() {
            if (isExecuting) return;
            window.runningAll = true;
            currentCell = 0;

            // Find first code cell
            while (currentCell < notebookCells.length && notebookCells[currentCell].type !== 'code') {
                currentCell++;
            }

            if (currentCell < notebookCells.length) {
                executeCell(currentCell);
            } else {
                window.runningAll = false;
            }
        }

        function advanceRunAll() {
            currentCell++;
            // Skip to next code cell
            while (currentCell < notebookCells.length && notebookCells[currentCell].type !== 'code') {
                currentCell++;
            }
            if (currentCell < notebookCells.length) {
                setTimeout(function() { executeCell(currentCell); }, 300);
            } else {
                window.runningAll = false;
            }
        }

        // ---------- Clear All Outputs ----------
        function clearOutputs() {
            window.runningAll = false;
            document.querySelectorAll('.output-area').forEach(function(el) {
                el.classList.add('hidden');
                el.innerHTML = '';
            });
        }

        // ---------- Reset Notebook ----------
        function resetNotebook() {
            window.runningAll = false;
            isExecuting = false;
            currentCell = 0;
            initNotebook();
        }

        // ---------- Initialise ----------
        function initNotebook() {
            var container = document.getElementById('notebook');
            container.innerHTML = '';

            notebookCells.forEach(function(cell, index) {
                container.appendChild(renderCell(cell, index));
            });

            // Apply syntax highlighting
            if (typeof Prism !== 'undefined') {
                Prism.highlightAll();
            }

            // Render math in markdown cells
            if (typeof renderMathInElement !== 'undefined') {
                document.querySelectorAll('.markdown-content').forEach(function(el) {
                    renderMathInElement(el, {
                        delimiters: [
                            {left: '$$', right: '$$', display: true},
                            {left: '$', right: '$', display: false},
                            {left: '\\(', right: '\\)', display: false},
                            {left: '\\[', right: '\\]', display: true}
                        ]
                    });
                });
            }
        }

        // Keyboard navigation: Ctrl+Enter runs focused cell
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                var focusedCell = document.activeElement.closest('.cell');
                if (focusedCell) {
                    var cellId = parseInt(focusedCell.id.replace('cell-', ''));
                    executeCell(cellId);
                }
            }
        });

        // Start the notebook
        document.addEventListener('DOMContentLoaded', function() {
            initNotebook();
        });
    </script>
</body>
</html>
